<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyNameis</title>
  <style>
    :root{ --card-w:360px; }
    *{ box-sizing:border-box }
    body{
      margin:0; padding:0; min-height:100vh;
      font-family:"Pretendard",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      display:flex; justify-content:center; align-items:center;
      background:url("https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80") no-repeat center/cover fixed;
      position:relative;
    }
    body::before{ content:""; position:absolute; inset:0; background:rgba(255,255,255,.95); z-index:0 }
    #content,#loading{ position:relative; z-index:1 }

    /* loading */
    #loading{
      position:fixed; inset:0; display:flex; flex-direction:column; gap:10px;
      justify-content:center; align-items:center; background:rgba(239,244,255,.9);
      color:#000; font-size:15px; font-weight:600; z-index:1000;
    }
    .dot-loader{ display:flex; gap:8px; margin-bottom:6px }
    .dot-loader span{ width:12px; height:12px; background:#5865F2; border-radius:50%;
      animation:jump .6s infinite alternate ease-in-out }
    .dot-loader span:nth-child(2){ animation-delay:.2s }
    .dot-loader span:nth-child(3){ animation-delay:.4s }
    @keyframes jump{ from{transform:translateY(0)} to{transform:translateY(-10px)} }

    /* card */
    #content{
      display:none; width:var(--card-w); border-radius:16px; overflow:hidden; background:#fff;
      box-shadow:0 8px 24px rgba(0,0,0,.25); animation:fadeIn 1s ease;
    }
    .card-top{
      background:
        linear-gradient(135deg, rgba(127,90,240,.2), rgba(255,128,191,.2)),
        url("https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80") center/cover no-repeat;
      padding:60px 20px 80px; text-align:center; color:#fff; position:relative;
    }
    .card-top img{
      width:110px; height:110px; border-radius:50%; border:4px solid #fff; object-fit:cover;
      box-shadow:0 4px 12px rgba(0,0,0,.3); position:absolute; bottom:-55px; left:50%;
      transform:translateX(-50%); background:#fff;
    }
    .card-bottom{ padding:70px 25px 30px; text-align:center }
    .card-bottom h1{ margin:-5px 0 10px; font-size:24px; font-weight:800; color:#111 }
    .tags{ display:flex; justify-content:center; gap:10px; margin-bottom:15px; flex-wrap:wrap }
    /* ì°¸ê³ : ì•„ë˜ .tagì˜ ê¸°ë³¸ box-shadowëŠ” renderì—ì„œ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤ */
    .tag{ padding:6px 14px; border-radius:20px; font-size:12px; font-weight:700; color:#111 color: #fff;
      background: #fd0000;  /* ì›ë³¸ ìœ ì§€ */
      box-shadow: 0 0 10px rgba(228,194,209, 1);
      transition: box-shadow 0.3s ease, transform 0.2s ease;}
    .tag-blue{ background:#c7d2fe } .tag-yellow{ background:#fde68a }
    .tag-pink{ background:#fd8a8a } .tag-gray{ background:#e5e7eb }

    .buttons{ display:flex; flex-direction:column; gap:12px; margin-top:15px }
    .btn{
      display:block; padding:12px 0; text-align:center; font-size:13px; font-weight:700;
      color:#111827; background:#f9fafb; border-radius:8px; text-decoration:none;
      box-shadow:0 2px 6px rgba(0,0,0,.1); transition:all .25s ease; word-break:keep-all;
    }
    .btn:hover{ background:#e5e7eb; transform:scale(1.03) }

    @keyframes fadeIn{ from{opacity:0; transform:translateY(20px)} to{transform:translateY(0)} }

    /* floating buttons */
    .fab{
      position:fixed; right:16px; bottom:16px; z-index:1200; display:flex; gap:8px; align-items:center;
    }
    .fab .settings-toggle, .fab .auth-toggle{
      width:48px; height:48px; border-radius:50%; border:none; cursor:pointer;
      background:#111; color:#fff; font-size:22px; line-height:1; box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    .auth-toggle{ background:#4b5563; font-size:18px }

    /* settings panel */
    .settings-panel{
      position:fixed; inset:auto 0 0 0; max-height:85vh; background:#fff; z-index:1100;
      border-radius:16px 16px 0 0; box-shadow:0 -12px 32px rgba(0,0,0,.18);
      transform:translateY(100%); transition:transform .35s ease;
    }
    .settings-panel.open{ transform:translateY(0) }
    .sp-head{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      padding:14px 16px; border-bottom:1px solid #f0f2f5; position:sticky; top:0; background:#fff; z-index:1;
    }
    .sp-title{ font-weight:800; font-size:16px }
    .sp-body{ padding:14px 16px 18px; overflow:auto; max-height:calc(85vh - 56px) }
    .grid{ display:grid; grid-template-columns:1fr; gap:10px }
    .row{ display:grid; grid-template-columns:1fr; gap:8px }
    .row-2{ display:grid; grid-template-columns:1fr 1fr; gap:8px }
    .row-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px }
    label{ font-size:12px; font-weight:700; color:#374151 }
    input[type="text"],input[type="url"],input[type="email"],input[type="password"]{
      width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:8px; font-size:14px; background:#fff;
    }
    select{ width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:8px; font-size:14px; background:#fff }
    .list{ display:flex; flex-direction:column; gap:8px }
    .item{ border:1px solid #eef0f3; border-radius:10px; padding:10px; display:grid; gap:8px }
    .item-head{ display:flex; align-items:center; justify-content:space-between; gap:8px }
    .item-actions{ display:flex; gap:6px }
    .btn-small{
      padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#fff; cursor:pointer; font-weight:700; font-size:12px;
    }
    .btn-primary{ background:#111; color:#fff; border-color:#111 }
    .btn-danger{ background:#fee2e2; border-color:#fecaca; color:#991b1b }
    .btn-ghost{ background:#f9fafb }
    .hr{ height:1px; background:#f0f2f5; margin:10px 0 }
    .actions{ display:flex; gap:8px; flex-wrap:wrap }
    .note{ font-size:12px; color:#6b7280 }

    /* auth modal */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:1300 }
    .modal.open{ display:flex }
    .modal-card{ width:min(480px, 92vw); background:#fff; border-radius:12px; box-shadow:0 10px 28px rgba(0,0,0,.25); padding:16px }
    .modal-head{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px }
    .modal-title{ font-weight:800 }
    .right{ margin-left:auto }
    .pill{ font-size:12px; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; }
    .auth-row{ display:grid; grid-template-columns:1fr; gap:8px; margin:8px 0 }
    .auth-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px }
    .login-hint{ font-size:12px; color:#6b7280 }
    @media (min-width: 900px){
      .settings-panel{ left:50%; right:auto; width:560px; margin-left:-280px; border-radius:16px }
      .sp-body{ max-height:calc(85vh - 56px) }
    }
  </style>
</head>
<body>
  <!-- loading -->
  <div id="loading">
    <div class="dot-loader"><span></span><span></span><span></span></div>
    <span id="loadingText">ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”</span>
  </div>

  <!-- card -->
  <div id="content" role="main" aria-label="ì†Œê°œ ì¹´ë“œ">
    <div class="card-top">
      <img id="profileImg" src="https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80" alt="í”„ë¡œí•„"/>
    </div>
    <div class="card-bottom">
      <h1 id="displayName">ë§ˆì´ ë„¤ì„</h1>
      <div class="tags" id="tagsWrap"></div>
      <div class="buttons" id="buttonsWrap"></div>
    </div>
  </div>

  <!-- floating buttons -->
  <div class="fab">
    <button class="auth-toggle" id="authToggle" title="ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ" aria-label="ë¡œê·¸ì¸">ğŸ‘¤</button>
    <button class="settings-toggle" id="settingsToggle" title="ì„¤ì • ì—´ê¸°/ë‹«ê¸°" aria-label="ì„¤ì •">âš™ï¸</button>
  </div>

  <!-- settings panel -->
  <aside class="settings-panel" id="settingsPanel" aria-label="ì„¤ì • íŒ¨ë„">
    <div class="sp-head">
      <div class="sp-title">íŒ¨ë„ ì„¤ì •</div>
      <div class="actions">
        <span id="sessionPill" class="pill" style="display:none"></span>
        <button class="btn-small btn-ghost" id="importBtn">ê°€ì ¸ì˜¤ê¸°</button>
        <button class="btn-small btn-ghost" id="exportBtn">ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn-small btn-danger" id="resetBtn">ì´ˆê¸°í™”</button>
        <button class="btn-small btn-primary" id="saveBtn">ì €ì¥</button>
      </div>
    </div>
    <div class="sp-body">
      <div class="grid">
        <div class="row-2">
          <div>
            <label>í˜ì´ì§€ íƒ€ì´í‹€</label>
            <input id="titleInput" type="text" placeholder="ë¸Œë¼ìš°ì € íƒ­ ì œëª©(ì„ íƒ)"/>
          </div>
          <div>
            <label>ë¡œë”© ë¬¸êµ¬</label>
            <input id="loadingMsgInput" type="text" placeholder="ë¶ˆëŸ¬ì˜¤ëŠ” ë™ì•ˆ ë³´ì¼ ë¬¸êµ¬"/>
          </div>
        </div>
        <div class="row">
          <label>ë””ìŠ¤í”Œë ˆì´ ì´ë¦„</label>
          <input id="nameInput" type="text" placeholder="ì¹´ë“œì— í‘œì‹œí•  ì´ë¦„"/>
        </div>
        <div class="row">
          <label>ë°°ê²½ ì‚¬ì§„ URL (body)</label>
          <input id="bgInput" type="url" placeholder="https://..."/>
        </div>
        <div class="row">
          <label>ë°°ë„ˆ ì‚¬ì§„ URL (ì¹´ë“œ ìƒë‹¨)</label>
          <input id="bannerInput" type="url" placeholder="https://..."/>
        </div>
        <div class="row">
          <label>í”„ë¡œí•„ ì‚¬ì§„ URL</label>
          <input id="profileInput" type="url" placeholder="https://..."/>
        </div>

        <!-- âœ¨ ì¶”ê°€: ë¡œë”© ìƒ‰ìƒ ì„¤ì • -->
        <div class="row-2">
          <div>
            <label>ë¡œë”© ë°°ê²½ ìƒ‰ (CSS Color)</label>
            <input id="loadingBgInput" type="text" placeholder="ì˜ˆ: rgba(239,244,255,0.9) ë˜ëŠ” #eff4ffcc"/>
          </div>
          <div>
            <label>ë¡œë”© ê³µ ìƒ‰ (CSS Color)</label>
            <input id="loadingDotInput" type="text" placeholder="ì˜ˆ: #5865F2 ë˜ëŠ” rgb(88,101,242)"/>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <label>íƒœê·¸</label>
          <div id="tagsList" class="list"></div>
          <button class="btn-small" id="addTagBtn">+ íƒœê·¸ ì¶”ê°€</button>
          <div class="note">ìƒ‰ìƒ ì½”ë“œëŠ” HEX / rgb() / rgba() ëª¨ë‘ ê°€ëŠ¥. <b>íƒœê·¸ ê·¸ë¦¼ì ìƒ‰ì„ ë¹„ìš°ë©´ ë°°ê²½ìƒ‰ê³¼ ë™ì¼</b>í•˜ê²Œ í‘œì‹œë¼ìš”.</div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <label>ë²„íŠ¼</label>
          <div id="linksList" class="list"></div>
          <button class="btn-small" id="addLinkBtn">+ ë²„íŠ¼ ì¶”ê°€</button>
          <div class="note">ë²„íŠ¼ì€ â€œì´ë¦„ + ë§í¬(URL)â€ë§Œ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.</div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <label>ê³µìœ </label>
          <div class="actions">
            <button class="btn-small" id="previewBtn">ë¯¸ë¦¬ë³´ê¸° ì ìš©</button>
            <button class="btn-small" id="shareLinkBtn">ê³µìœ  ë§í¬ ë§Œë“¤ê¸°</button>
            <button class="btn-small" id="saveToAccountBtn">ê³„ì •ì— ì €ì¥</button>
            <button class="btn-small" id="loadFromAccountBtn">ê³„ì •ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          </div>
          <div class="note">ì €ì¥ì€ ì´ ë¸Œë¼ìš°ì €(localStorage)ì— ë³´ê´€ë©ë‹ˆë‹¤. ë¡œê·¸ì¸í•˜ë©´ ë™ì¼ ê¸°ê¸°ì—ì„œ ìë™ ë³µì›ë¼ìš”. êµì°¨ ê¸°ê¸°ëŠ” ê³µìœ  ë§í¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- templates -->
  <template id="tagTpl">
    <div class="item tag-item">
      <div class="item-head">
        <strong>íƒœê·¸</strong>
        <div class="item-actions">
          <button class="btn-small btn-danger tag-del">ì‚­ì œ</button>
        </div>
      </div>
      <div class="row-2">
        <div>
          <label>í…ìŠ¤íŠ¸</label>
          <input type="text" class="tag-text" placeholder="ì˜ˆ: ì¹˜ë¦°ì´ì§‘"/>
        </div>
        <div>
          <label>ìƒ‰ìƒ</label>
          <select class="tag-color">
            <option value="tag-blue">íŒŒë‘</option>
            <option value="tag-yellow">ë…¸ë‘</option>
            <option value="tag-pink">í•‘í¬</option>
            <option value="tag-gray">íšŒìƒ‰</option>
          </select>
        </div>
      </div>
      <div class="row">
        <label>ìƒ‰ìƒ ì½”ë“œ (ì„ íƒ) â€” HEX ë˜ëŠ” rgb/rgba</label>
        <input type="text" class="tag-color-code" placeholder="#ff5577 ë˜ëŠ” rgb(255,85,119)"/>
      </div>
      <!-- âœ¨ ì¶”ê°€: íƒœê·¸ ê·¸ë¦¼ì ìƒ‰ -->
      <div class="row">
        <label>íƒœê·¸ ê·¸ë¦¼ì ìƒ‰ (ì„ íƒ) â€” ë¹„ìš°ë©´ íƒœê·¸ ìƒ‰ê³¼ ë™ì¼</label>
        <input type="text" class="tag-shadow-code" placeholder="ì˜ˆ: rgba(0,0,0,0.18) ë˜ëŠ” #c7d2fe"/>
      </div>
    </div>
  </template>

  <template id="linkTpl">
    <div class="item link-item">
      <div class="item-head">
        <strong>ë²„íŠ¼</strong>
        <div class="item-actions">
          <button class="btn-small btn-danger link-del">ì‚­ì œ</button>
        </div>
      </div>
      <div class="row">
        <label>ë²„íŠ¼ ì´ë¦„</label>
        <input type="text" class="link-label" placeholder="ì˜ˆ: ì‹ ê³ ë¬¸ì˜"/>
      </div>
      <div class="row">
        <label>ì—°ê²° ë§í¬(URL)</label>
        <input type="url" class="link-url" placeholder="https://example.com"/>
      </div>
    </div>
  </template>

  <!-- auth modal -->
  <div class="modal" id="authModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="modal-head">
        <div class="modal-title" id="authTitle">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</div>
        <button class="btn-small btn-ghost" id="authClose">ë‹«ê¸°</button>
      </div>
      <div class="auth-row">
        <label>ì´ë©”ì¼</label>
        <input id="authEmail" type="email" placeholder="you@example.com" autocomplete="email"/>
      </div>
      <div class="auth-row">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input id="authPw" type="password" placeholder="8ì ì´ìƒ" autocomplete="current-password"/>
      </div>
      <div class="login-hint">ì²˜ìŒ ë¡œê·¸ì¸í•˜ë©´ í•´ë‹¹ ì´ë©”ì¼ë¡œ ê³„ì •ì´ ìƒì„±ë©ë‹ˆë‹¤(ë¡œì»¬ ì €ì¥).</div>
      <div class="auth-actions">
        <button class="btn-small" id="logoutBtn" style="display:none">ë¡œê·¸ì•„ì›ƒ</button>
        <button class="btn-small btn-primary" id="loginBtn">ë¡œê·¸ì¸</button>
      </div>
    </div>
  </div>

  <script>
  // --------- ê¸°ë³¸ê°’ ----------
  const DEFAULTS = {
    pageTitle: "MyNameis",
    loadingText: "ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”",
    backgroundUrl: "https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80",
    bannerUrl: "https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80",
    profileUrl: "https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80",
    name: "ë§ˆì´ë„¤ì„",
    /* âœ¨ ì¶”ê°€: ë¡œë”© ë°°ê²½/ë„íŠ¸ ê¸°ë³¸ê°’ */
    loadingBg: "rgba(239,244,255,0.9)",
    loadingDot: "#5865F2",
    tags: [
      { text:"ë§ˆì´ë„¤ì„ì´ì¦ˆ", color:"tag-blue",  shadowColor:"" },
      { text:"ì†Œê°œí˜ì´ì§€",   color:"tag-yellow",shadowColor:"" },
      { text:"ì›¹ì‚¬ì´íŠ¸",     color:"tag-pink",  shadowColor:"" }
    ],
    buttons: [ ]
  };

  // --------- helpers ----------
  const $ = (s, el=document)=> el.querySelector(s);
  const $$ = (s, el=document)=> [...el.querySelectorAll(s)];
  const isSafeUrl = u => /^https?:\/\//i.test(u||"");

  const LS_KEY = "panelConfig.v2"; // bump schema
  const USER_KEY = (email)=> `user:${email.toLowerCase()}`;

  function encodeCfg(cfg){ return btoa(unescape(encodeURIComponent(JSON.stringify(cfg)))) }
  function decodeCfg(s){ try{ return JSON.parse(decodeURIComponent(escape(atob(s)))) }catch(e){ return null } }

  function saveLocal(cfg){ localStorage.setItem(LS_KEY, JSON.stringify(cfg)) }
  function loadLocal(){
    const url = new URL(location.href);
    const c = url.searchParams.get("c");
    if(c){ const d = decodeCfg(c); if(d) return d; }
    try{ const raw = localStorage.getItem(LS_KEY); if(raw) return JSON.parse(raw) }catch(e){}
    return structuredClone(DEFAULTS);
  }

  // cookies (simple)
  function setCookie(name, value, days=7){
    const d = new Date(); d.setTime(d.getTime()+days*24*60*60*1000);
    document.cookie = `${name}=${encodeURIComponent(value)}; expires=${d.toUTCString()}; path=/; samesite=Lax`;
  }
  function getCookie(name){
    return document.cookie.split("; ").reduce((acc, c)=>{
      const [k, v] = c.split("="); return k===name ? decodeURIComponent(v) : acc;
    }, "");
  }
  function eraseCookie(name){ document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/` }

  // sha256 with SubtleCrypto
  async function sha256(str){
    if(window.crypto?.subtle){
      const buf = new TextEncoder().encode(str);
      const hash = await crypto.subtle.digest("SHA-256", buf);
      return [...new Uint8Array(hash)].map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    // fallback (NOT secure)
    return str.split("").reduce((a,c)=>((a<<5)-a)+c.charCodeAt(0),0).toString(16);
  }

  function getUser(email){
    try{ const raw = localStorage.getItem(USER_KEY(email)); return raw? JSON.parse(raw): null }catch(e){ return null }
  }
  function setUser(email, data){
    localStorage.setItem(USER_KEY(email), JSON.stringify(data));
  }

  // --- color helpers (minimal) ---
  const HEX_RE = /^#([0-9a-f]{3}|[0-9a-f]{6})$/i;
  const RGB_RE = /^rgba?\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}(?:\s*,\s*(0|1|0?\.\d+))?\s*\)$/i;
  function isCssColor(v){ return HEX_RE.test(v||"") || RGB_RE.test(v||""); }
  function hexToRgb(hex){
    let h = hex.slice(1); if(h.length===3){ h = h.split('').map(c=>c+c).join(''); }
    const n = parseInt(h,16); return { r:(n>>16)&255, g:(n>>8)&255, b:n&255 };
  }
  function rgbStringToRgb(s){
    const m = s.replace(/[rgba()\s]/g,'').split(',').map(Number);
    return { r:m[0], g:m[1], b:m[2], a:(m[3]!==undefined? m[3]:1) };
  }
  function getContrastTextColor(color){
    let r,g,b;
    if(HEX_RE.test(color)){ ({r,g,b} = hexToRgb(color)); }
    else if(RGB_RE.test(color)){ ({r,g,b} = rgbStringToRgb(color)); }
    else { return '#111'; }
    const toLin = v=>{ v/=255; return v<=0.03928? v/12.92 : Math.pow((v+0.055)/1.055, 2.4); };
    const L = 0.2126*toLin(r) + 0.7152*toLin(g) + 0.0722*toLin(b);
    return L > 0.6 ? '#111' : '#fff';
  }
  const PRESET_COLORS = { "tag-blue":"#c7d2fe", "tag-yellow":"#fde68a", "tag-pink":"#fd8a8a", "tag-gray":"#e5e7eb" };

  // --------- ë Œë”ëŸ¬ ----------
  function render(cfg){
    // íƒ€ì´í‹€/ë¡œë”©ë¬¸êµ¬
    document.title = cfg.pageTitle || cfg.name || document.title;
    $("#loadingText").textContent = cfg.loadingText || DEFAULTS.loadingText;

    // âœ¨ ë¡œë”© ë°°ê²½/ë„íŠ¸ ìƒ‰ ì ìš©
    if (cfg.loadingBg)  { const L = $("#loading"); if (L) L.style.background = cfg.loadingBg; }
    if (cfg.loadingDot) { document.querySelectorAll(".dot-loader span").forEach(s=> s.style.background = cfg.loadingDot); }

    // ë°°ê²½/ë°°ë„ˆ
    document.body.style.backgroundImage = `url("${cfg.backgroundUrl}")`;
    $(".card-top").style.backgroundImage = `
      linear-gradient(135deg, rgba(127,90,240,.2), rgba(255,128,191,.2)),
      url("${cfg.bannerUrl}")
    `;
    // í”„ë¡œí•„/ì´ë¦„
    $("#profileImg").src = cfg.profileUrl || "";
    $("#displayName").textContent = cfg.name || "";

    // íƒœê·¸
    const tw = $("#tagsWrap"); tw.innerHTML = "";
    (cfg.tags||[]).forEach(t=>{
      const d = document.createElement("div");
      d.className = "tag";

      // ë°°ê²½ìƒ‰ ê³„ì‚°(ì½”ë“œ/í”„ë¦¬ì…‹)
      let bgColor = null;
      if (isCssColor(t.color)) {
        bgColor = t.color;
        d.style.background = t.color;
        d.style.color = getContrastTextColor(t.color);
      } else {
        const klass = t.color || "tag-gray";
        d.className = `tag ${klass}`;
        bgColor = PRESET_COLORS[klass] || "#e5e7eb";
      }

      // í…ìŠ¤íŠ¸
      d.textContent = t.text||"";

      // âœ¨ ê·¸ë¦¼ììƒ‰: ì§€ì •ê°’ì´ ìœ íš¨í•˜ë©´ ì‚¬ìš©, ì•„ë‹ˆë©´ ë°°ê²½ìƒ‰ê³¼ ë™ì¼
      const sColor = (t.shadowColor && isCssColor(t.shadowColor)) ? t.shadowColor : bgColor;
      d.style.boxShadow = `0 8px 18px ${sColor}`;

      tw.appendChild(d);
    });

    // ë²„íŠ¼
    const bw = $("#buttonsWrap"); bw.innerHTML = "";
    (cfg.buttons||[]).forEach(b=>{
      if(!b.label || !isSafeUrl(b.url)) return;
      const a = document.createElement("a");
      a.className="btn"; a.target="_blank"; a.rel="noopener";
      a.textContent = b.label; a.href = b.url; bw.appendChild(a);
    });
  }

  // --------- ì„¤ì • í¼ ë°”ì¸ë”© ----------
  const panel = $("#settingsPanel");
  const toggleBtn = $("#settingsToggle");
  const authToggle = $("#authToggle");
  const sessionPill = $("#sessionPill");

  const titleInput = $("#titleInput");
  const loadingMsgInput = $("#loadingMsgInput");
  const nameInput = $("#nameInput");
  const bgInput = $("#bgInput");
  const bannerInput = $("#bannerInput");
  const profileInput = $("#profileInput");

  /* âœ¨ ì¶”ê°€ ì…ë ¥ ìš”ì†Œ */
  const loadingBgInput = $("#loadingBgInput");
  const loadingDotInput = $("#loadingDotInput");

  const tagsList = $("#tagsList");
  const linksList = $("#linksList");

  function openPanel(o=true){ panel.classList.toggle("open", o) }
  toggleBtn.addEventListener("click", ()=>{
    // ë¡œê·¸ì¸ í•„ìš”: ë¯¸ë¡œê·¸ì¸ ì‹œ ì•ˆë‚´ í›„ ë¡œê·¸ì¸ ëª¨ë‹¬ ì—´ê¸°
    if (!(window.currentUser || getCookie("sessionEmail"))) {
      alert("íŒ¨ë„ì„ ì—´ê¸° ì „ì— ë¡œê·¸ì¸ ë˜ëŠ” íšŒì›ê°€ì…ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      const titleEl = document.getElementById("authTitle");
      if (titleEl) titleEl.textContent = "ë¡œê·¸ì¸ / íšŒì›ê°€ì…";
      const _email = document.getElementById("authEmail");
      const _pw = document.getElementById("authPw");
      const _logoutBtn = document.getElementById("logoutBtn");
      const _loginBtn = document.getElementById("loginBtn");
      if (_email){ _email.value = ""; _email.disabled = false; }
      if (_pw){ _pw.value = ""; }
      if (_logoutBtn){ _logoutBtn.style.display = "none"; }
      if (_loginBtn){ _loginBtn.textContent = "ë¡œê·¸ì¸"; }
      if (typeof openAuth === "function") openAuth(true); // ë¡œê·¸ì¸ ëª¨ë‹¬ ì—´ê¸°
      return;
    }
    // ë¡œê·¸ì¸ ìƒíƒœë©´ ê¸°ì¡´ì²˜ëŸ¼ íŒ¨ë„ í† ê¸€
    openPanel(!panel.classList.contains("open"));
  });

  function addTagRow(tag={text:"", color:"tag-gray", shadowColor:""}){
    const tpl = $("#tagTpl").content.cloneNode(true);
    const row = tpl.querySelector(".tag-item");
    row.querySelector(".tag-text").value = tag.text||"";
    if (isCssColor(tag.color)) {
      row.querySelector(".tag-color-code").value = tag.color;
      row.querySelector(".tag-color").value = "tag-gray";
    } else {
      row.querySelector(".tag-color").value = tag.color||"tag-gray";
    }
    // âœ¨ ê·¸ë¦¼ììƒ‰ ë³µì›
    if (tag.shadowColor){ const sc = row.querySelector(".tag-shadow-code"); if (sc) sc.value = tag.shadowColor; }
    row.querySelector(".tag-del").addEventListener("click", ()=> row.remove());
    tagsList.appendChild(tpl);
  }
  function addLinkRow(link={label:"", url:""}){
    const tpl = $("#linkTpl").content.cloneNode(true);
    const row = tpl.querySelector(".link-item");
    row.querySelector(".link-label").value = link.label||"";
    row.querySelector(".link-url").value = link.url||"";
    row.querySelector(".link-del").addEventListener("click", ()=> row.remove());
    linksList.appendChild(tpl);
  }
  function fillForm(from){
    titleInput.value = from.pageTitle||"";
    loadingMsgInput.value = from.loadingText||"";
    nameInput.value = from.name||"";
    bgInput.value = from.backgroundUrl||"";
    bannerInput.value = from.bannerUrl||"";
    profileInput.value = from.profileUrl||"";
    /* âœ¨ ë¡œë”© ìƒ‰ìƒ ë³µì› */
    loadingBgInput.value  = from.loadingBg  || DEFAULTS.loadingBg;
    loadingDotInput.value = from.loadingDot || DEFAULTS.loadingDot;

    tagsList.innerHTML = ""; (from.tags||[]).forEach(addTagRow);
    linksList.innerHTML = ""; (from.buttons||[]).forEach(addLinkRow);
  }
  function collectForm(){
    const tags = $$(".tag-item", tagsList).map(el=>({
      text: $(".tag-text", el).value.trim(),
      color: ($(".tag-color-code", el)?.value.trim()) || $(".tag-color", el).value || "tag-gray",
      /* âœ¨ per-tag shadowColor (ë¹„ìš°ë©´ "") */
      shadowColor: $(".tag-shadow-code", el)?.value.trim() || ""
    })).filter(t=>t.text);
    const buttons = $$(".link-item", linksList).map(el=>({
      label: $(".link-label", el).value.trim(),
      url: $(".link-url", el).value.trim()
    })).filter(b=> b.label && isSafeUrl(b.url));
    return {
      pageTitle: titleInput.value.trim() || nameInput.value.trim() || DEFAULTS.pageTitle,
      loadingText: loadingMsgInput.value.trim() || DEFAULTS.loadingText,
      backgroundUrl: bgInput.value.trim() || DEFAULTS.backgroundUrl,
      bannerUrl: bannerInput.value.trim() || DEFAULTS.bannerUrl,
      profileUrl: profileInput.value.trim() || DEFAULTS.profileUrl,
      name: nameInput.value.trim() || DEFAULTS.name,
      /* âœ¨ ë¡œë”© ìƒ‰ìƒ ìˆ˜ì§‘ */
      loadingBg:  loadingBgInput.value.trim()  || DEFAULTS.loadingBg,
      loadingDot: loadingDotInput.value.trim() || DEFAULTS.loadingDot,
      tags, buttons
    };
  }

  $("#addTagBtn").addEventListener("click", ()=> addTagRow());
  $("#addLinkBtn").addEventListener("click", ()=> addLinkRow());

  $("#previewBtn").addEventListener("click", ()=> { const c=collectForm(); render(c); });

  // âœ¨ ì €ì¥ ì‹œ URL ?c=ë„ ìµœì‹ ê°’ìœ¼ë¡œ ê°±ì‹  â†’ ìƒˆë¡œê³ ì¹¨í•´ë„ ìƒ‰ ìœ ì§€
  $("#saveBtn").addEventListener("click", ()=>{
    const c=collectForm(); saveLocal(c); render(c);
    // ì£¼ì†Œì°½ì˜ c ê°±ì‹ 
    try{
      const u = new URL(location.href);
      u.searchParams.set("c", encodeCfg(c));
      history.replaceState(null,"",u);
    }catch(e){}
    if(currentUser){ saveToAccount(currentUser, c); }
    alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    openPanel(false);
  });

  $("#resetBtn").addEventListener("click", ()=>{
    if(confirm("ëª¨ë“  ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜ëŒë¦´ê¹Œìš”?")){
      saveLocal(DEFAULTS); fillForm(DEFAULTS); render(DEFAULTS);
      alert("ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.");
    }
  });
  $("#exportBtn").addEventListener("click", ()=>{
    const blob = new Blob([JSON.stringify(collectForm(),null,2)], {type:"application/json"});
    const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download="panel-config.json"; a.click();
    URL.revokeObjectURL(a.href);
  });
  $("#importBtn").addEventListener("click", ()=>{
    const inp = document.createElement("input"); inp.type="file"; inp.accept="application/json";
    inp.onchange = ()=>{
      const f = inp.files[0]; if(!f) return;
      const r = new FileReader();
      r.onload = ()=>{
        try{
          const c = JSON.parse(r.result);
          fillForm(c); render(c); alert("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ. ì €ì¥ì„ ëˆŒëŸ¬ ë°˜ì˜í•˜ì„¸ìš”.");
        }catch{ alert("ì˜ëª»ëœ JSON íŒŒì¼ì…ë‹ˆë‹¤."); }
      };
      r.readAsText(f);
    };
    inp.click();
  });
  $("#shareLinkBtn").addEventListener("click", ()=>{
    const encoded = encodeCfg(collectForm());
    const url = new URL(location.href); url.searchParams.set("c", encoded);
    navigator.clipboard?.writeText(url.toString());
    prompt("ê³µìœ  ë§í¬ë¥¼ ë³µì‚¬í•´ê°€ì„¸ìš”:", url.toString());
  });

  // ê³„ì • ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°(ë¡œê·¸ì¸ í•„ìš”)
  $("#saveToAccountBtn").addEventListener("click", ()=>{
    if(!currentUser) return alert("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.");
    const c = collectForm(); saveToAccount(currentUser, c);
    alert("ê³„ì •ì— ì €ì¥í–ˆìŠµë‹ˆë‹¤. (ì´ ë¸Œë¼ìš°ì €ì˜ localStorageì— ë³´ê´€)");
  });
  $("#loadFromAccountBtn").addEventListener("click", ()=>{
    if(!currentUser) return alert("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.");
    const data = getUser(currentUser);
    if(data?.config){ fillForm(data.config); render(data.config); alert("ê³„ì • ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤."); }
    else alert("ê³„ì •ì— ì €ì¥ëœ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.");
  });

  // --------- ì¸ì¦(ì¿ í‚¤ ê¸°ë°˜ ì„¸ì…˜) ----------
  let currentUser = null;
  const authModal = $("#authModal");
  const authEmail = $("#authEmail");
  const authPw = $("#authPw");
  const loginBtn = $("#loginBtn");
  const logoutBtn = $("#logoutBtn");
  const authClose = $("#authClose");

  function openAuth(o=true){ authModal.classList.toggle("open", o); if(o){ authEmail.focus(); } }
  authToggle.addEventListener("click", ()=>{
    if(currentUser){ // ì´ë¯¸ ë¡œê·¸ì¸ â†’ ë¹ ë¥´ê²Œ ë¡œê·¸ì•„ì›ƒ ì„ íƒ ê°€ëŠ¥
      openAuth(true);
      $("#authTitle").textContent = "ê³„ì • ì •ë³´";
      authEmail.value = currentUser;
      authEmail.disabled = true;
      authPw.value = "";
      logoutBtn.style.display = "";
      loginBtn.textContent = "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ / ì¬ë¡œê·¸ì¸";
    } else {
      $("#authTitle").textContent = "ë¡œê·¸ì¸ / íšŒì›ê°€ì…";
      authEmail.value = "";
      authEmail.disabled = false;
      authPw.value = "";
      logoutBtn.style.display = "none";
      loginBtn.textContent = "ë¡œê·¸ì¸";
      openAuth(true);
    }
  });
  authClose.addEventListener("click", ()=> openAuth(false));

  logoutBtn.addEventListener("click", ()=>{
    if(!currentUser) return;
    eraseCookie("sessionEmail");
    currentUser = null;
    sessionPill.style.display = "none";
    alert("ë¡œê·¸ì•„ì›ƒí–ˆìŠµë‹ˆë‹¤.");
    openAuth(false);
  });

  loginBtn.addEventListener("click", async ()=>{
    const email = authEmail.value.trim().toLowerCase();
    const pw = authPw.value;
    if(!email || !pw){ return alert("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); }
    const hash = await sha256(pw);
    const u = getUser(email);
    if(!u){
      // signup
      setUser(email, { email, hash, createdAt: Date.now(), config: collectForm() });
      setCookie("sessionEmail", email, 7);
      currentUser = email;
      sessionPill.textContent = `ë¡œê·¸ì¸: ${email}`;
      sessionPill.style.display = "";
      alert("ê³„ì •ì„ ìƒì„±í•˜ê³  ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤.");
      openAuth(false);
    }else{
      if(u.hash !== hash){
        if(confirm("ë¹„ë°€ë²ˆí˜¸ê°€ ë‹¤ë¦…ë‹ˆë‹¤. ì´ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½í• ê¹Œìš”?")){
          u.hash = hash; setUser(email, u);
          alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.");
        }else{
          return;
        }
      }
      setCookie("sessionEmail", email, 7);
      currentUser = email;
      sessionPill.textContent = `ë¡œê·¸ì¸: ${email}`;
      sessionPill.style.display = "";
      // ê³„ì • ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì˜µì…˜ ì œê³µ
      if(u.config){
        if(confirm("ê³„ì •ì— ì €ì¥í•œ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ê¹Œìš”?")){
          fillForm(u.config); render(u.config); saveLocal(u.config);
          // ì €ì¥ ì§í›„ ì£¼ì†Œì°½ cë„ ê°±ì‹ (ì„ íƒ)
          try{ const uu=new URL(location.href); uu.searchParams.set("c", encodeCfg(u.config)); history.replaceState(null,"",uu);}catch(e){}
        }
      }
      openAuth(false);
    }
  });

  function saveToAccount(email, cfg){
    const u = getUser(email) || { email, hash:"", createdAt:Date.now() };
    u.config = cfg;
    setUser(email, u);
  }

  // --------- ì´ˆê¸° ë¡œë“œ ----------
  const cfg = loadLocal();
  window.addEventListener("load", ()=>{
    setTimeout(()=>{
      $("#loading").style.display="none";
      $("#content").style.display="block";
    }, 1200);
  });
  fillForm(cfg); render(cfg);

  // ?edit=1 â†’ ì„¤ì • ìë™ ì˜¤í”ˆ
  if(new URL(location.href).searchParams.get("edit")==="1"){ openPanel(true); }

  // ì„¸ì…˜ ë³µì›
  const sess = getCookie("sessionEmail");
  if(sess){
    currentUser = sess;
    sessionPill.textContent = `ë¡œê·¸ì¸: ${sess}`;
    sessionPill.style.display = "";
  }
  </script>
</body>
</html>
